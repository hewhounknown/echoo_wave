<div class="d-flex flex-column h-100">
    <!-- Chat Header -->
    <header class="bg-white border-bottom p-3 d-flex justify-content-between align-items-center flex-shrink-0">
        <div class="d-flex align-items-center gap-3">
            <button class="btn btn-link d-lg-none" data-bs-toggle="offcanvas" data-bs-target="#sidebar">
                <i class="fas fa-bars"></i>
            </button>
            <h5 class="mb-0 fw-bold">{{ user.username|title }}</h5>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-link text-dark">
                <i class="fas fa-phone"></i>
            </button>
            <button class="btn btn-link text-dark">
                <i class="fas fa-video"></i>
            </button>
            <button class="btn btn-link text-dark">
                <i class="fas fa-ellipsis-v"></i>
            </button>
        </div>
    </header>

    <!-- Messages Container -->
    <div class="flex-grow-1 overflow-auto p-4 bg-white" id="messages" style="height: 0; min-height: 0; display: flex; flex-direction: column-reverse;">
        <!-- Received Message -->
        
        {% for chat in chats  reversed%}
            {% if chat.sender.username == 'admin' %}
                <!-- Sent Message -->
                <div class="d-flex gap-3 mb-4 justify-content-end">
                    <div>
                        <div class="bg-primary text-white p-3 rounded-3">
                            <p class="mb-0">{{ chat.message }}</p>
                        </div>
                        <small class="text-muted d-block mt-1 text-end">{{ chat.created_at|date:"h:i A" }}</small>
                    </div>
                    <div class="bg-info text-white rounded-circle d-flex align-items-center justify-content-center fw-bold"
                         style="width: 36px; height: 36px; flex-shrink: 0;">A</div>
                </div>
            {% else %}
                <!-- Received Message -->
                <div class="d-flex gap-3 mb-4">
                    <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center fw-bold"
                         style="width: 36px; height: 36px; flex-shrink: 0;">{{ user.username|slice:":2"|upper }}</div>
                    <div>
                        <div class="bg-light p-3 rounded-3">
                            <p class="mb-0">{{ chat.message }}</p>
                        </div>
                        <small class="text-muted d-block mt-1">{{ chat.created_at|date:"h:i A" }}</small>
                    </div>
                </div>
            {% endif %}
        {% empty %}
            <div class="text-center text-muted mt-5">No messages yet</div>
        {% endfor %}
    </div>

    <!-- Chat Footer -->
    <footer class="bg-white border-top p-3 flex-shrink-0">
        <form hx-post="#" hx-target="#messages" hx-swap="beforeend" hx-on::after-request="this.reset(); document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;">
            <div class="input-group">
                <input type="text" name="message" class="form-control rounded-pill border" placeholder="Type a message..." required>
                <button class="btn btn-primary rounded-circle" type="submit">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </form>
    </footer>
</div>

<script>
// Auto-scroll to bottom when page loads
document.addEventListener('DOMContentLoaded', function() {
    const messagesContainer = document.getElementById('messages');
    if (messagesContainer) {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
});

// Also scroll to bottom after HTMX requests
document.addEventListener('htmx:afterRequest', function(event) {
    const messagesContainer = document.getElementById('messages');
    if (messagesContainer && event.detail.target.id === 'messages') {
        setTimeout(() => {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }, 10);
    }
});
</script>